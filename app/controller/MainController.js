/*
 * File: app/controller/MainController.js
 *
 * This file was generated by Sencha Architect version 2.2.2.
 * http://www.sencha.com/products/architect/
 *
 * This file requires use of the Sencha Touch 2.2.x library, under independent license.
 * License of Sencha Architect does not include license for Sencha Touch 2.2.x. For more
 * details see http://www.sencha.com/license or contact license@sencha.com.
 *
 * This file will be auto-generated each and everytime you save your project.
 *
 * Do NOT hand edit this file.
 */

Ext.define('MyApp.controller.MainController', {
    extend: 'Ext.app.Controller',

    config: {
        refs: {
            peopleList: 'peopleContainer list',
            tabPanel: 'categoriesTabPanel',
            detailsContainer: 'detailsContainer',
            sendSmsButton: 'detailsContainer button[action=sendSms]',
            organizationsList: 'organizationsContainer list',
            othersList: 'othersContainer list'
        },

        control: {
            "peopleList": {
                itemtap: 'onPeopleListItemTap'
            },
            "organizationsList": {
                itemtap: 'onOrganizationsListItemTap'
            },
            "othersList": {
                itemtap: 'onOthersListItemTap'
            },
            "sendSmsButton": {
                tap: 'onSendSmsButtonTap'
            }
        }
    },

    onPeopleListItemTap: function(thisObj, index, target, record, e, eOpts) {

        this.navigateToDetails(this.indexes.peopleList, record);
    },

    onOrganizationsListItemTap: function(thisObj, index, target, record, e, eOpts) {

        this.navigateToDetails(this.indexes.organizationsList, record);

    },

    onOthersListItemTap: function(thisObj, index, target, record, e, eOpts) {
        this.navigateToDetails(this.indexes.othersList, record);
    },

    onSendSmsButtonTap: function(button, e, eOpts) {

        var me = this,
            record = me.activeRecord;

        var location = 'sms:' + '17777?body=' + record.get('text');
        console.log(location);
        window.location = 'sms:' + '17777?body=' + record.get('text');

    },

    launch: function() {

        var me = this;

        me.indexes = {
            peopleList: 0,
            organizationsList: 1,
            othersList: 2,
            details: 3,
            history: 4

        }

        me.getDetailsContainer().element.on(
        { 
            swipe: function (e) {
                me.getTabPanel().setActiveItem(me.comingFrom);  
            } 
        });
    },

    navigateToDetails: function(comingFrom, record) {
        var me = this,
            tabPanel = this.getTabPanel();

        me.comingFrom = comingFrom;
        me.getDetailsContainer().setHtml(me.getDetailsContainer().config.template(record));
        tabPanel.setActiveItem(me.indexes.details);
        me.activeRecord = record;
    }

});